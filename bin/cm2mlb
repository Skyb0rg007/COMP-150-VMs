#!/usr/bin/env lua5.1

require 'ioutil'

local ingroup = false

io.write('$(SML_LIB)/basis/basis.mlb\n')
for f in io.arg_files(arg) do
  for l in f:lines() do
    if l:find '^is%s*$' then
      ingroup = false
    elseif ingroup then
      -- do nothing
    elseif l:find '^group%s*$' then
      ingroup = true
    elseif l:find '%$/basis.cm' then
      -- do nothing
    elseif l:find '%$/smlnj%-lib%.cm' then
      io.write('$(SML_LIB)/smlnj-lib/smlnj-lib.mlb\n')
      io.write('$(SML_LIB)/smlnj-lib/Util/smlnj-lib.mlb\n')
    elseif l:find '%$qcheck/qcheck.cm' then
      io.write('/home/nr/net/qcheck/qcheck.mlb')
    elseif not l:find 'group is' then
      l = l:gsub('%(%*.-%*%)', '')
      io.write((l:gsub('%.cm%s*$', '.mlb')), '\n')
    end
  end
end
